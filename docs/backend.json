{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile, storing information such as contact details and mine association.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User entity. (Relationship: User 1:1 UserProfile)"
        },
        "firstName": {
          "type": "string",
          "description": "The user's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The user's last name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "mineName": {
          "type": "string",
          "description": "The name of the mine the user is associated with."
        },
        "jobTitle": {
          "type": "string",
          "description": "The user's job title."
        }
      },
      "required": [
        "id",
        "userId",
        "firstName",
        "lastName",
        "email",
        "mineName",
        "jobTitle"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the CarbonSight AI platform. Stores basic user information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address. Used for login.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profiles/{profileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Access is restricted to the user identified by {userId}. The {profileId} is autogenerated upon creation. `userId` is autogenerated by firebase authentication, so it should be passed into the profile upon profile creation to tie them together. Used for Authorization Independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, obtained from Firebase Authentication."
            },
            {
              "name": "profileId",
              "description": "The unique identifier of the user profile document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user information. Used for authentication. Should not be directly modified by users after initial creation.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, obtained from Firebase Authentication."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure prioritizes secure user data management and clear authorization. It uses path-based ownership for `UserProfiles`, placing them under `/users/{userId}` to ensure only the authenticated user can access their profile data. This structure simplifies security rules and eliminates the need for complex `get()` calls.  Authorization Independence is achieved because access to the profile is solely determined by the `userId` in the path, which corresponds to `request.auth.uid`. This structure supports required QAPs by segregating user profiles based on their unique user IDs, enabling efficient and secure `list` operations that are naturally scoped to each user. This approach ensures that rules are not filters, as each user's data is logically separated within the database structure."
  }
}